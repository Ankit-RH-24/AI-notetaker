<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Saved Transcripts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.6s ease-in-out both;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="relative bg-gradient-to-br from-blue-100 via-white to-cyan-100 min-h-screen overflow-y-auto px-4 py-12">

  <!-- üåê Optional Floating Background Blob -->
  <svg class="absolute top-[-80px] left-[-80px] blur-3xl opacity-20 w-[500px] h-[500px] z-0" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
    <path fill="#38bdf8" d="M56.8,-64.1C70.2,-50.1,76.4,-28.4,73.9,-10.6C71.5,7.1,60.4,21.9,48.1,32.3C35.9,42.7,22.6,48.6,8.4,54.8C-5.8,61,-20.9,67.5,-34.3,63.2C-47.7,58.8,-59.4,43.6,-65.5,26.6C-71.6,9.6,-72,-9.2,-64.2,-23.3C-56.4,-37.4,-40.5,-46.8,-24.9,-58.1C-9.3,-69.5,6,-82.8,21.5,-83.5C37.1,-84.2,55.4,-72.4,56.8,-64.1Z" transform="translate(100 100)" />
  </svg>

  <!-- üåà Outer Card Border -->
  <div class="relative z-10 p-1 rounded-3xl bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 shadow-xl max-w-4xl mx-auto">

    <!-- üí¨ Glassy Container -->
    <div class="w-full bg-white/80 backdrop-blur-lg shadow-2xl rounded-2xl p-8 fade-in">

      <!-- üóÇÔ∏è Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-extrabold text-blue-700 mb-2">üíæ Saved Transcripts</h1>
        <p class="text-gray-500">Browse or manage your previously recorded notes</p>
      </div>

      <!-- üîô Back Button -->
      <div class="mb-6 text-center">
        <button onclick="window.location='/'"
          class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">
          ‚¨ÖÔ∏è Back
        </button>
      </div>

      <!-- üìÑ Transcript List -->
      <div>
        <ul id="savedList" class="space-y-4"></ul>
      </div>

    </div>
  </div>

  <!-- üß† Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const token = localStorage.getItem("mednote_id_token");

      if (!token) {
        document.getElementById("savedList").innerHTML = `
          <li class="text-center text-red-500 py-10 bg-white/70 backdrop-blur-md rounded-xl shadow-sm">
            ‚ö†Ô∏è You're not logged in. Please log in to view your transcripts.
          </li>`;
        return;
      }

      fetch("/api/transcripts/list", {
        method: "GET",
        headers: {
          "Authorization": `Bearer ${token}`
        }
      })
        .then(res => {
          if (res.status === 401) {
            throw new Error("Unauthorized");
          }
          return res.json();
        })
        .then(data => {
          const list = document.getElementById("savedList");

          if (data.length === 0) {
            list.innerHTML = `<li class="text-center text-gray-500 py-10 bg-white/70 backdrop-blur-md rounded-xl shadow-sm">No transcripts saved yet.</li>`;
            return;
          }

          data.forEach(item => {
            const li = document.createElement("li");
            li.className = "bg-white/80 backdrop-blur-md border border-gray-200 p-5 rounded-xl shadow-sm hover:shadow-lg transition duration-200";

            const date = new Date(item.timestamp).toLocaleString();

            li.innerHTML = `
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-lg font-semibold text-gray-800">${item.name}</p>
                  <p class="text-sm text-gray-500">${date}</p>
                </div>
                <div class="flex gap-2">
                  <button onclick="view('${item.id}')" class="bg-blue-600 text-white px-4 py-1.5 rounded hover:bg-blue-700 transition">üîç View</button>
                  <button onclick="deleteTranscript('${item.id}')" class="bg-red-500 text-white px-4 py-1.5 rounded hover:bg-red-600 transition">üóë Delete</button>
                </div>
              </div>
            `;
            list.appendChild(li);
          });
        })
        .catch(err => {
          console.error("Fetch error:", err);
          document.getElementById("savedList").innerHTML = `
            <li class="text-center text-red-500 py-10 bg-white/70 backdrop-blur-md rounded-xl shadow-sm">
              ‚ùå Failed to load transcripts. Please log in again.
            </li>`;
        });

      window.view = function(id) {
        localStorage.setItem("current_id", id);
        window.location = "/view";
      }

      window.deleteTranscript = function(id) {
        if (!confirm("Are you sure you want to delete this transcript?")) return;

        fetch(`/api/transcripts/delete/${id}`, {
          method: "DELETE",
          headers: {
            "Authorization": `Bearer ${token}`
          }
        })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              alert("Transcript deleted successfully.");
              location.reload();
            } else {
              alert("Error deleting transcript: " + (data.error || "Unknown error"));
            }
          })
          .catch(err => {
            console.error("Delete failed:", err);
            alert("Delete failed. See console for details.");
          });
      }
    });
  </script>

</body>
</html>
